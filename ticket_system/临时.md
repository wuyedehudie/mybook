车次表（id，车次名，类型）
区间表（id，出发站A，终点站B，外键（车次id），A）
区间车票表（区间车票id，车组，价格，类型，座位，数量，外键（区间表id））
订单车票表（订单id，区间车票id）
订单表（订单id，总价格ID，出发站A，终点站B，车票id，日期，用户id）

INSERT INTO trains(train_name,type) VALUES
('G1176','复兴号'),
('G6411','复兴号'),
('G6004','复兴号'),
('G6172','复兴号');

INSERT INTO train_segments (train_id, start_station, end_station, sequence,departure_time, arrival_time) VALUES
(1, '汕头', '潮汕', 1,'10:00:00','10:23:00'),
(1, '潮汕', '汕尾', 2,'10:28:00','11:11:00'),
(1, '汕尾', '深圳北', 3,'11:13:00','12:04:00'),
(1, '深圳北', '虎门', 4,'12:07:00','12:24:00'),
(1, '虎门', '广州南', 5,'12:26:00','12:43:00');

INSERT INTO train_segments (train_id, start_station, end_station, sequence,departure_time, arrival_time) VALUES
(3, '汕头', '潮汕', 1,'06:52:00','07:14:00'),
(3, '潮汕', '汕尾', 2,'07:31:00','08:06:00'),
(3, '汕尾', '惠阳', 3,'08:08:00','08:37:00'),
(3, '惠阳', '深圳北', 4,'08:39:00','09:05:00'),
(3, '深圳北', '虎门', 5,'09:10:00','09:27:00');

UPDATE train_segments
SET price = 
    CASE segment_id
        WHEN 1 THEN 20.00  -- 汕头到潮汕的价格
        WHEN 2 THEN 30.00  -- 潮汕到汕尾的价格
        WHEN 3 THEN 40.00  -- 汕尾到深圳北的价格
        WHEN 4 THEN 40.00  -- 深圳北到虎门的价格
        WHEN 5 THEN 100.00  -- 虎门到广州南的价格
        WHEN 6 THEN 20.00   -- 汕头到潮汕的价格（另一个车次）
        WHEN 7 THEN 30.00  -- 潮汕到汕尾的价格（另一个车次）
        WHEN 8 THEN 10.00   -- 汕尾到惠阳的价格（另一个车次）
        WHEN 9 THEN 30.00  -- 惠阳到深圳北的价格（另一个车次）
        WHEN 10 THEN 100.00  -- 深圳北到虎门的价格（另一个车次）
        ELSE 0.00            -- 如果有其他行，设定默认值
    END;


SELECT * FROM train_segments WHERE start_station = '汕头' OR end_station = '深圳北';


INSERT INTO ticket_inventory (segment_id, train_id, price, car_type, seat_type, available_seats) VALUES
(1, 1, 40.00, '二等座', 'A', 100),
(1, 1, 40.00, '二等座', 'B', 100),
(1, 1, 40.00, '二等座', 'C', 100),
(1, 1, 40.00, '二等座', 'D', 100),
(1, 1, 40.00, '二等座', 'F', 100),
(2, 1, 45.00, '二等座', 'A', 100),
(2, 1, 45.00, '二等座', 'B', 100),
(2, 1, 45.00, '二等座', 'C', 100),
(2, 1, 45.00, '二等座', 'D', 100),
(2, 1, 45.00, '二等座', 'F', 100),
(3, 1, 48.00, '二等座', 'A', 100),
(3, 1, 48.00, '二等座', 'B', 100),
(3, 1, 48.00, '二等座', 'C', 100),
(3, 1, 48.00, '二等座', 'D', 100),
(3, 1, 48.00, '二等座', 'F', 100),
(4, 1, 30.00, '二等座', 'A', 100),
(4, 1, 30.00, '二等座', 'B', 100),
(4, 1, 30.00, '二等座', 'C', 100),
(4, 1, 30.00, '二等座', 'D', 100),
(4, 1, 30.00, '二等座', 'F', 100),
(5, 1, 25.00, '二等座', 'A', 100),
(5, 1, 25.00, '二等座', 'B', 100),
(5, 1, 25.00, '二等座', 'C', 100),
(5, 1, 25.00, '二等座', 'D', 100),
(5, 1, 25.00, '二等座', 'F', 100);



INSERT INTO train_segments (train_id, start_station, end_station, sequence) VALUES
(2, '汕头', '潮汕', 1),
(2, '潮汕', '汕尾', 2),
(2, '汕尾', '惠州北', 3),
(2, '惠州北', '虎门', 4),
(2, '虎门', '广州南', 5);

-- 假设 train_segments 表中的 segment_id 是自动生成的自增主键
-- 插入 segment_tickets 表中的车票信息
-- 对应汕头到潮汕的区间
INSERT INTO segment_tickets (segment_id, train_set, price, seat_type, seat_code, quantity) VALUES
(1, 'A', 120.00, '二等座', 'A01', 100),
(1, 'B', 150.00, '一等座', 'B05', 50),
(1, 'C', 180.00, '商务座', 'C08', 20);
-- 对应潮汕到汕尾的区间
INSERT INTO segment_tickets (segment_id, train_set, price, seat_type, seat_code, quantity) VALUES
(2, 'A', 100.00, '二等座', 'A03', 120),
(2, 'B', 130.00, '一等座', 'B07', 60),
(2, 'C', 160.00, '商务座', 'C10', 30);
-- 对应汕尾到深圳北的区间
INSERT INTO segment_tickets (segment_id, train_set, price, seat_type, seat_code, quantity) VALUES
(3, 'A', 180.00, '二等座', 'A05', 80),
(3, 'B', 210.00, '一等座', 'B09', 40),
(3, 'C', 240.00, '商务座', 'C12', 15);
-- 对应深圳北到虎门的区间
INSERT INTO segment_tickets (segment_id, train_set, price, seat_type, seat_code, quantity) VALUES
(4, 'A', 90.00, '二等座', 'A07', 150),
(4, 'B', 120.00, '一等座', 'B11', 70),
(4, 'C', 150.00, '商务座', 'C14', 25);
-- 对应虎门到广州南的区间
INSERT INTO segment_tickets (segment_id, train_set, price, seat_type, seat_code, quantity) VALUES
(5, 'A', 60.00, '二等座', 'A09', 200),
(5, 'B', 90.00, '一等座', 'B13', 100),
(5, 'C', 120.00, '商务座', 'C16', 30);



CREATE TABLE orders (
    order_id INT PRIMARY KEY AUTO_INCREMENT,
    total_price DECIMAL(10, 2) NOT NULL,
    start_station VARCHAR(100) NOT NULL,
    end_station VARCHAR(100) NOT NULL,
    ticket_info VARCHAR(255),
    order_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    user_id INT NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);


INSERT INTO trains(train_name,type) VALUES
('G1176','复兴号'),
('G6411','复兴号'),
('G6004','复兴号'),
('G6172','复兴号');
INSERT INTO train_segments (train_id, start_station, end_station, sequence,departure_time, arrival_time) VALUES
(1, '汕头', '潮汕', 1,'10:00:00','10:23:00'),
(1, '潮汕', '汕尾', 2,'10:28:00','11:11:00'),
(1, '汕尾', '深圳北', 3,'11:13:00','12:04:00'),
(1, '深圳北', '虎门', 4,'12:07:00','12:24:00'),
(1, '虎门', '广州南', 5,'12:26:00','12:43:00');
如果要汕头到深圳北的票，即需要区间车票的sequence为1，2，3，4的四张票，如何查询出一个出发时间和到达时间，以及车次号G1176，还要总的车票价格



SELECT train_id,sequence FROM train_segments WHERE start_station = '汕头' OR end_station = '深圳北';

SELECT train_id, SUM(price) AS total_price
FROM train_segments
WHERE  train_id = '' AND sequence BETWEEN 1 AND 3 
GROUP BY train_id;



GROUP BY train_id;


SELECT 
    ts.train_id,
    t.train_name,
    SUM(st.price) AS total_price
FROM train_segments ts
JOIN trains t ON ts.train_id = t.train_id
JOIN segment_tickets st ON ts.segment_id = st.segment_id
WHERE ts.sequence BETWEEN 1 AND 3 -- 区间车票的 sequence 序号范围
AND EXISTS (
    -- 子查询确保找到包含所有连续区间的同一车次
    SELECT 1 FROM train_segments
    WHERE train_id = ts.train_id
    AND sequence BETWEEN 1 AND 3
)AND 
GROUP BY ts.train_id, t.train_name;
